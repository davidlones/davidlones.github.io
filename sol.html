<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SOL // War-Room Dashboard Mock</title>

  <style>
    :root{
      --bg0:#070b12;
      --bg1:#0b1220;
      --panel:#0f1a2e;
      --panel2:#0c1629;
      --line:rgba(235,245,255,.12);
      --line2:rgba(235,245,255,.08);
      --text:#eef6ff;
      --muted:#a9bbd6;

      --cyan:#7cd4ff;
      --lime:#b5ff7c;
      --amber:#ffcc66;
      --red:#ff6b6b;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --radius2: 12px;
    }

    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      color:var(--text);
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(124,212,255,.18), transparent 60%),
        radial-gradient(900px 600px at 80% 20%, rgba(181,255,124,.12), transparent 55%),
        radial-gradient(1000px 800px at 50% 110%, rgba(255,204,102,.08), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0) 55%);
      overflow:hidden;
    }

    /* Layout */
    .app{
      height:100%;
      display:grid;
      grid-template-rows:auto 1fr auto;
    }

    header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      border-bottom:1px solid var(--line2);
      background:linear-gradient(180deg, rgba(15,26,46,.9), rgba(7,11,18,.0));
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      min-width:280px;
    }
    .sigil{
      width:38px;height:38px;border-radius:12px;
      background:
        radial-gradient(circle at 30% 30%, rgba(124,212,255,.9), transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(181,255,124,.85), transparent 60%),
        linear-gradient(180deg, rgba(255,204,102,.35), rgba(255,107,107,.0));
      box-shadow: 0 0 0 1px rgba(235,245,255,.14), var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .sigil:after{
      content:"";
      position:absolute; inset:-40%;
      background: conic-gradient(from 90deg, rgba(124,212,255,.0), rgba(124,212,255,.35), rgba(181,255,124,.0));
      animation: spin 6s linear infinite;
      opacity:.6;
    }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    .brand h1{
      margin:0;
      font-size:14px;
      letter-spacing:.18em;
      text-transform:uppercase;
    }
    .brand .sub{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      opacity:.95;
      margin-top:2px;
    }

    .statusbar{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    .pill{
      display:flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border:1px solid var(--line2);
      background:rgba(15,26,46,.55);
      border-radius:999px;
      box-shadow:0 6px 16px rgba(0,0,0,.22);
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background:var(--cyan);
      box-shadow: 0 0 18px rgba(124,212,255,.65);
    }
    .dot.lime{ background:var(--lime); box-shadow:0 0 18px rgba(181,255,124,.45) }
    .dot.amber{ background:var(--amber); box-shadow:0 0 18px rgba(255,204,102,.45) }
    .dot.red{ background:var(--red); box-shadow:0 0 18px rgba(255,107,107,.55) }

    /* Main grid */
    main{
      height:100%;
      padding:14px 14px 10px;
      display:grid;
      grid-template-columns: 1.35fr .85fr;
      gap:14px;
      overflow:hidden;
    }

    .col{
      display:grid;
      gap:14px;
      overflow:hidden;
    }

    .panel{
      background: linear-gradient(180deg, rgba(15,26,46,.85), rgba(12,22,41,.55));
      border:1px solid var(--line2);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:120px;
    }

    .panel .head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 14px 10px;
      border-bottom:1px solid var(--line2);
      background: rgba(7,11,18,.22);
    }

    .title{
      display:flex;
      gap:10px;
      align-items:baseline;
      min-width:0;
    }
    .title h2{
      margin:0;
      font-size:12px;
      letter-spacing:.16em;
      text-transform:uppercase;
    }
    .title span{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width:52ch;
    }

    .actions{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    button, .chip{
      border:1px solid var(--line2);
      background: rgba(15,26,46,.55);
      color: var(--text);
      border-radius: 999px;
      padding:7px 10px;
      font-family: var(--mono);
      font-size:12px;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{ background: rgba(15,26,46,.75); border-color: rgba(124,212,255,.25) }
    button:active{ transform: translateY(1px) }

    .chip{
      cursor:default;
      color:var(--muted);
    }
    .chip strong{ color:var(--text); font-weight:600 }

    .body{
      padding:12px 14px 14px;
      overflow:auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(124,212,255,.35) rgba(0,0,0,0);
    }
    .body::-webkit-scrollbar{ width:10px }
    .body::-webkit-scrollbar-thumb{
      background: rgba(124,212,255,.24);
      border-radius: 999px;
      border: 2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }

    /* World model canvas */
    .worldwrap{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:12px;
      align-items:stretch;
      min-height:340px;
    }
    @media (max-width: 980px){
      body{ overflow:auto }
      main{ grid-template-columns: 1fr; overflow:visible }
      .worldwrap{ grid-template-columns: 1fr; }
    }

    .screen{
      border-radius: var(--radius2);
      border: 1px solid var(--line2);
      background:
        radial-gradient(800px 450px at 50% 35%, rgba(124,212,255,.10), transparent 55%),
        radial-gradient(600px 400px at 80% 60%, rgba(181,255,124,.08), transparent 60%),
        linear-gradient(180deg, rgba(7,11,18,.6), rgba(12,22,41,.35));
      box-shadow: inset 0 0 0 1px rgba(235,245,255,.05);
      position:relative;
      overflow:hidden;
    }

    .scanlines:before{
      content:"";
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(235,245,255,.03),
          rgba(235,245,255,.03) 1px,
          rgba(0,0,0,0) 3px,
          rgba(0,0,0,0) 6px
        );
      opacity:.35;
      pointer-events:none;
      mix-blend-mode: overlay;
    }

    canvas{ width:100%; height:100%; display:block }

    .legend{
      display:grid;
      gap:10px;
      align-content:start;
    }
    .kpi{
      border:1px solid var(--line2);
      border-radius: var(--radius2);
      padding:10px 10px;
      background: rgba(7,11,18,.22);
      display:grid;
      gap:6px;
    }
    .kpi .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-family: var(--mono);
      font-size:12px;
      color: var(--muted);
    }
    .kpi .row b{ color:var(--text); font-weight:700 }
    .bar{
      height:10px;
      border-radius:999px;
      border:1px solid var(--line2);
      background: rgba(0,0,0,.18);
      overflow:hidden;
    }
    .bar > i{
      display:block;
      height:100%;
      width:55%;
      background: linear-gradient(90deg, rgba(124,212,255,.85), rgba(181,255,124,.55));
      box-shadow: 0 0 18px rgba(124,212,255,.25);
    }

    .mini{
      font-family: var(--mono);
      font-size:12px;
      color: var(--muted);
      line-height:1.45;
      padding:10px;
      border:1px dashed rgba(235,245,255,.14);
      border-radius: var(--radius2);
      background: rgba(7,11,18,.16);
    }

    /* Sensor grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:10px;
    }
    .card{
      border:1px solid var(--line2);
      border-radius: var(--radius2);
      background: rgba(7,11,18,.18);
      padding:10px;
      display:grid;
      gap:8px;
    }
    .card .top{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:8px;
    }
    .card h3{
      margin:0;
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .card .meta{
      font-family: var(--mono);
      font-size:11px;
      color: var(--muted);
    }
    .val{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      font-family: var(--mono);
    }
    .val .num{
      font-size:22px;
      letter-spacing:.02em;
    }
    .val .unit{ color:var(--muted); font-size:12px }
    .spark{
      height:28px;
      border:1px solid var(--line2);
      border-radius:999px;
      background: rgba(0,0,0,.16);
      position:relative;
      overflow:hidden;
    }
    .spark:before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 10% 50%, rgba(124,212,255,.75), transparent 40%),
        radial-gradient(circle at 40% 45%, rgba(181,255,124,.55), transparent 42%),
        radial-gradient(circle at 72% 55%, rgba(255,204,102,.45), transparent 45%),
        radial-gradient(circle at 90% 45%, rgba(124,212,255,.55), transparent 40%);
      opacity:.7;
      filter: blur(.2px);
      transform: translateX(-10%);
      animation: drift 4s ease-in-out infinite alternate;
    }
    @keyframes drift{
      from{ transform: translateX(-12%) }
      to{ transform: translateX(8%) }
    }

    /* Timeline */
    .timeline{
      display:grid;
      gap:10px;
    }
    .event{
      border:1px solid var(--line2);
      border-radius: var(--radius2);
      background: rgba(7,11,18,.18);
      padding:10px;
      display:grid;
      gap:6px;
    }
    .event .t{
      font-family: var(--mono);
      color: var(--muted);
      font-size:11px;
    }
    .event .msg{
      font-family: var(--mono);
      font-size:12px;
      line-height:1.5;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line2);
      background: rgba(15,26,46,.4);
      font-family: var(--mono);
      font-size:11px;
      color: var(--muted);
      width: fit-content;
    }

    /* Logs */
    .log{
      font-family: var(--mono);
      font-size:12px;
      line-height:1.5;
      white-space:pre-wrap;
      color: var(--text);
    }
    .log .dim{ color: var(--muted) }
    .log .ok{ color: var(--lime) }
    .log .warn{ color: var(--amber) }
    .log .bad{ color: var(--red) }
    .log .cyan{ color: var(--cyan) }

    /* Footer / command line */
    footer{
      border-top:1px solid var(--line2);
      padding:10px 14px;
      background: rgba(7,11,18,.35);
      backdrop-filter: blur(10px);
      display:flex;
      gap:10px;
      align-items:center;
    }
    .cli{
      flex:1;
      display:flex;
      gap:10px;
      align-items:center;
      border:1px solid var(--line2);
      border-radius: 14px;
      padding:10px 12px;
      background: rgba(15,26,46,.45);
      box-shadow: inset 0 0 0 1px rgba(235,245,255,.04);
      font-family: var(--mono);
      color: var(--muted);
      min-width:0;
    }
    .prompt{ color: var(--cyan) }
    input{
      flex:1;
      background: transparent;
      border:none;
      outline:none;
      color: var(--text);
      font-family: var(--mono);
      font-size:13px;
      min-width:0;
    }
    .hint{
      font-family: var(--mono);
      color: var(--muted);
      font-size:11px;
      opacity:.9;
      white-space:nowrap;
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="sigil" aria-hidden="true"></div>
        <div>
          <h1>SOL // Interface</h1>
          <div class="sub">WORLD MODEL • SENSORS • ARCHIVE • PROBABILITY THEATER</div>
        </div>
      </div>

      <div class="statusbar">
        <div class="pill"><span class="dot lime"></span> STATUS: <b style="color:var(--text)">NOMINAL</b></div>
        <div class="pill"><span class="dot"></span> MODEL: <b style="color:var(--text)">SOL-Ω</b></div>
        <div class="pill"><span class="dot amber"></span> DEFCON: <b style="color:var(--text)">SIM-3</b></div>
        <div class="pill"><span class="dot red"></span> ANOMALY: <b id="anom" style="color:var(--text)">0.07</b></div>
      </div>
    </header>

    <main>
      <!-- LEFT COLUMN -->
      <section class="col">
        <!-- WORLD MODEL -->
        <article class="panel">
          <div class="head">
            <div class="title">
              <h2>World Model</h2>
              <span id="wmSub">Vector overlay / inference arcs / time-indexed media</span>
            </div>
            <div class="actions">
              <span class="chip">Overlay: <strong>Earth</strong></span>
              <button id="btnScan">Scan</button>
              <button id="btnReframe">Reframe</button>
              <button id="btnFreeze">Freeze</button>
            </div>
          </div>

          <div class="body">
            <div class="worldwrap">
              <div class="screen scanlines" style="min-height:340px;">
                <canvas id="world" width="900" height="520" aria-label="World model canvas"></canvas>
              </div>

              <div class="legend">
                <div class="kpi">
                  <div class="row"><span>Scene coherence</span><b id="coh">0.82</b></div>
                  <div class="bar" aria-hidden="true"><i id="cohBar" style="width:82%"></i></div>
                  <div class="row"><span>Prediction horizon</span><b id="hz">+00:18:42</b></div>
                </div>

                <div class="kpi">
                  <div class="row"><span>Archive lock</span><b id="lock">ENGAGED</b></div>
                  <div class="row"><span>New media frames</span><b id="frames">+12</b></div>
                  <div class="row"><span>Branch candidates</span><b id="branches">3</b></div>
                </div>

                <div class="mini">
                  <span class="cyan">[SOL]</span> Interpretation layer enabled.
                  <br/>Vector arcs are <span class="amber">hypotheses</span>, not fact.
                  <br/>Reality remains a stubborn file format.
                </div>

                <div class="kpi">
                  <div class="row"><span>Threat modeling</span><b id="threat">LOW</b></div>
                  <div class="row"><span>Sensor confidence</span><b id="sconf">0.91</b></div>
                  <div class="row"><span>Drift</span><b id="drift">+0.004</b></div>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- SYSTEM LOG -->
        <article class="panel">
          <div class="head">
            <div class="title">
              <h2>Screenplay Log</h2>
              <span>Evented narration + diagnostics (human-readable, machine-hostile)</span>
            </div>
            <div class="actions">
              <button id="btnAppend">Append</button>
              <button id="btnClear">Clear</button>
            </div>
          </div>
          <div class="body">
            <div id="log" class="log"></div>
          </div>
        </article>
      </section>

      <!-- RIGHT COLUMN -->
      <section class="col">
        <!-- SENSORS -->
        <article class="panel">
          <div class="head">
            <div class="title">
              <h2>Sensors</h2>
              <span>Ambient + household + “the universe is noisy”</span>
            </div>
            <div class="actions">
              <span class="chip">Mode: <strong>Live</strong></span>
              <button id="btnJitter">Jitter</button>
            </div>
          </div>
          <div class="body">
            <div class="grid" id="sensorGrid"></div>
          </div>
        </article>

        <!-- TIMELINE -->
        <article class="panel">
          <div class="head">
            <div class="title">
              <h2>Timeline</h2>
              <span>Anchors for replay / branching / “what did we think we saw?”</span>
            </div>
            <div class="actions">
              <button id="btnMark">Mark</button>
              <button id="btnExport">Export</button>
            </div>
          </div>
          <div class="body">
            <div class="timeline" id="timeline"></div>
          </div>
        </article>
      </section>
    </main>

    <footer>
      <div class="cli">
        <span class="prompt">sol&gt;</span>
        <input id="cmd" placeholder="type a command… (try: help, scan, mark, branch, replay -10m)" autocomplete="off" />
        <span class="hint" id="hint">enter ↵</span>
      </div>
      <button id="btnRun">Run</button>
    </footer>
  </div>

  <script>
    // ---------------------------
    // Mock data + helpers
    // ---------------------------
    const $ = (s) => document.querySelector(s);
    const logEl = $("#log");
    const timelineEl = $("#timeline");
    const gridEl = $("#sensorGrid");

    const sensors = [
      { key:"PM2.5", name:"Air Purifier", unit:"µg/m³", value: 12.4, ok:[0,35] },
      { key:"Humidity", name:"Lab Climate", unit:"%", value: 41.2, ok:[25,60] },
      { key:"Pressure", name:"Atmospheric", unit:"hPa", value: 1012.8, ok:[980,1040] },
      { key:"Temp", name:"Lab Temperature", unit:"°F", value: 72.6, ok:[60,80] },
      { key:"EMF", name:"Interference", unit:"mG", value: 1.8, ok:[0,6] },
      { key:"Noise", name:"Ambient", unit:"dB", value: 33.0, ok:[0,55] }
    ];

    function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
    function rnd(a,b){ return a + Math.random()*(b-a); }
    function nowTime(){
      const d = new Date();
      return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
    }
    function stamp(){
      const d = new Date();
      return d.toLocaleString([], {month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit', second:'2-digit'});
    }

    function severity(v, ok){
      if(!ok) return "ok";
      const [lo, hi] = ok;
      const mid = (lo+hi)/2;
      const span = (hi-lo)/2;
      const dist = Math.abs(v-mid)/span; // 0 at center, ~1 at edges
      if(dist <= 1.0) return "ok";
      if(dist <= 1.25) return "warn";
      return "bad";
    }

    function addLog(line, cls="dim"){
      const t = nowTime();
      const div = document.createElement("div");
      div.innerHTML = `<span class="dim">[${t}]</span> <span class="${cls}">${escapeHtml(line)}</span>`;
      logEl.appendChild(div);
      logEl.scrollTop = logEl.scrollHeight;
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function addEvent(tag, msg){
      const el = document.createElement("div");
      el.className = "event";
      el.innerHTML = `
        <div class="t">${stamp()}</div>
        <div class="tag"><span class="dot ${tagColor(tag)}" style="width:7px;height:7px;"></span>${escapeHtml(tag)}</div>
        <div class="msg">${escapeHtml(msg)}</div>
      `;
      timelineEl.prepend(el);
    }

    function tagColor(tag){
      if(tag === "ANCHOR") return "lime";
      if(tag === "SCAN") return "";
      if(tag === "BRANCH") return "amber";
      if(tag === "ALERT") return "red";
      return "";
    }

    function renderSensors(){
      gridEl.innerHTML = "";
      sensors.forEach(s => {
        const sev = severity(s.value, s.ok);
        const dotClass = sev === "ok" ? "lime" : (sev === "warn" ? "amber" : "red");
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="top">
            <div>
              <h3>${escapeHtml(s.key)}</h3>
              <div class="meta">${escapeHtml(s.name)}</div>
            </div>
            <span class="chip"><span class="dot ${dotClass}" style="width:7px;height:7px;margin-right:6px;display:inline-block;"></span>${sev.toUpperCase()}</span>
          </div>

          <div class="val">
            <div class="num">${s.value.toFixed(1)}</div>
            <div class="unit">${escapeHtml(s.unit)}</div>
          </div>

          <div class="spark" aria-hidden="true"></div>
        `;
        gridEl.appendChild(card);
      });
    }

    // ---------------------------
    // World model canvas (vector-ish)
    // ---------------------------
    const canvas = $("#world");
    const ctx = canvas.getContext("2d");
    let frozen = false;
    let t0 = performance.now();

    function drawWorld(time){
      const w = canvas.width, h = canvas.height;

      // Clear with subtle vignette
      ctx.clearRect(0,0,w,h);
      const g = ctx.createRadialGradient(w*0.5,h*0.45, 50, w*0.5,h*0.45, Math.max(w,h)*0.75);
      g.addColorStop(0, "rgba(124,212,255,0.08)");
      g.addColorStop(0.6, "rgba(15,26,46,0.00)");
      g.addColorStop(1, "rgba(0,0,0,0.25)");
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);

      // "Grid"
      ctx.globalAlpha = 0.35;
      ctx.strokeStyle = "rgba(235,245,255,0.08)";
      ctx.lineWidth = 1;
      for(let x=0; x<=w; x+=60){
        ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke();
      }
      for(let y=0; y<=h; y+=60){
        ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke();
      }
      ctx.globalAlpha = 1;

      // Faux continents as vector blobs
      ctx.strokeStyle = "rgba(124,212,255,0.35)";
      ctx.lineWidth = 2;
      ctx.fillStyle = "rgba(124,212,255,0.05)";
      blob(w*0.34,h*0.42, 160, 90, 7);
      blob(w*0.62,h*0.48, 210, 120, 8);

      // "Hotspots"
      const phase = (time - t0)/1000;
      const pts = [
        {x:w*0.28,y:h*0.38, c:"rgba(181,255,124,0.9)"},
        {x:w*0.55,y:h*0.46, c:"rgba(255,204,102,0.9)"},
        {x:w*0.72,y:h*0.52, c:"rgba(124,212,255,0.9)"}
      ];
      pts.forEach((p,i)=>{
        const r = 6 + 2*Math.sin(phase*2 + i);
        glowDot(p.x,p.y,r,p.c);
      });

      // "Inference arcs"
      const a = Math.sin(phase*0.8)*0.5 + 0.5;
      arc(w*0.28,h*0.38, w*0.55,h*0.46, a, "rgba(181,255,124,0.55)");
      arc(w*0.55,h*0.46, w*0.72,h*0.52, 1-a, "rgba(255,204,102,0.55)");
      arc(w*0.28,h*0.38, w*0.72,h*0.52, 0.35, "rgba(124,212,255,0.45)");

      // HUD text
      ctx.font = "12px " + getComputedStyle(document.documentElement).getPropertyValue("--mono");
      ctx.fillStyle = "rgba(235,245,255,0.75)";
      ctx.fillText("VECTOR OVERLAY // PROBABILISTIC TRACKS", 14, 22);
      ctx.fillStyle = "rgba(169,187,214,0.75)";
      ctx.fillText("NOTE: arcs denote hypotheses; not a guarantee of physics behaving politely.", 14, 42);
    }

    function blob(cx,cy, rx, ry, n){
      ctx.beginPath();
      for(let i=0;i<=n;i++){
        const a = (i/n)*Math.PI*2;
        const wob = 0.82 + 0.22*Math.sin(i*1.7 + 0.8);
        const x = cx + Math.cos(a)*rx*wob;
        const y = cy + Math.sin(a)*ry*(0.86 + 0.22*Math.cos(i*1.4));
        if(i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      }
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    }

    function glowDot(x,y,r,color){
      ctx.save();
      ctx.beginPath();
      ctx.arc(x,y,r,0,Math.PI*2);
      ctx.fillStyle = color;
      ctx.shadowColor = color;
      ctx.shadowBlur = 18;
      ctx.fill();
      ctx.restore();
      // crosshair
      ctx.strokeStyle = "rgba(235,245,255,0.18)";
      ctx.lineWidth = 1;
      ctx.beginPath(); ctx.moveTo(x-12,y); ctx.lineTo(x+12,y); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x,y-12); ctx.lineTo(x,y+12); ctx.stroke();
    }

    function arc(x1,y1,x2,y2,p,color){
      // Quadratic control point
      const mx = (x1+x2)/2;
      const my = (y1+y2)/2;
      const dx = x2-x1, dy = y2-y1;
      const len = Math.hypot(dx,dy) || 1;
      const nx = -dy/len, ny = dx/len;
      const bend = 90;
      const cx = mx + nx*bend*(0.4 + p);
      const cy = my + ny*bend*(0.4 + p);

      ctx.save();
      ctx.strokeStyle = color;
      ctx.lineWidth = 2;
      ctx.shadowColor = color;
      ctx.shadowBlur = 12;
      ctx.beginPath();
      ctx.moveTo(x1,y1);
      ctx.quadraticCurveTo(cx,cy,x2,y2);
      ctx.stroke();

      // moving "packet"
      const t = (performance.now()/1000) % 1;
      const tt = (t + p*0.33) % 1;
      const pt = quadPoint(x1,y1,cx,cy,x2,y2, tt);
      ctx.shadowBlur = 18;
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(pt.x,pt.y,3.5,0,Math.PI*2);
      ctx.fill();
      ctx.restore();
    }

    function quadPoint(x1,y1,cx,cy,x2,y2,t){
      const u = 1-t;
      return {
        x: u*u*x1 + 2*u*t*cx + t*t*x2,
        y: u*u*y1 + 2*u*t*cy + t*t*y2
      };
    }

    function loop(ts){
      if(!frozen) drawWorld(ts);
      requestAnimationFrame(loop);
    }

    // ---------------------------
    // UI behaviors
    // ---------------------------
    function jitterSensors(){
      sensors.forEach(s => {
        const jig = (s.key === "Temp") ? rnd(-0.4,0.4)
                 : (s.key === "Humidity") ? rnd(-1.2,1.2)
                 : (s.key === "Pressure") ? rnd(-0.8,0.8)
                 : rnd(-0.6,0.6);
        s.value = clamp(s.value + jig, -9999, 9999);
      });
      renderSensors();

      // update anomaly (just vibes)
      const an = rnd(0.03, 0.18);
      $("#anom").textContent = an.toFixed(2);

      // coherence
      const coh = clamp(parseFloat($("#coh").textContent) + rnd(-0.02,0.02), 0.55, 0.98);
      $("#coh").textContent = coh.toFixed(2);
      $("#cohBar").style.width = Math.round(coh*100) + "%";
    }

    function doScan(){
      addLog("[SCAN] sweeping sensors → overlay reconciliation", "cyan");
      addEvent("SCAN", "Sweep: reconcile sensors + archive frames; generate candidate arcs.");
      $("#frames").textContent = "+" + Math.floor(rnd(6,22));
      $("#branches").textContent = Math.floor(rnd(1,6));
      $("#drift").textContent = (rnd(0.001, 0.012)).toFixed(3);
      jitterSensors();
    }

    function doMark(){
      addLog("[ANCHOR] time-indexed mark committed", "ok");
      addEvent("ANCHOR", "Anchor created: snapshot of current world model state.");
    }

    function doBranch(){
      addLog("[BRANCH] speculative branch generated (low confidence)", "warn");
      addEvent("BRANCH", "Branch created: adjacent explanation for anomalies.");
      $("#threat").textContent = (Math.random() < 0.15) ? "ELEVATED" : "LOW";
    }

    function doReframe(){
      addLog("[REFRAME] changing model lens: less certainty, more honesty", "cyan");
      $("#wmSub").textContent = "Vector overlay / uncertainty emphasized / fewer lies per pixel";
      const coh = clamp(parseFloat($("#coh").textContent) - rnd(0.01,0.05), 0.55, 0.98);
      $("#coh").textContent = coh.toFixed(2);
      $("#cohBar").style.width = Math.round(coh*100) + "%";
    }

    function doFreeze(){
      frozen = !frozen;
      $("#btnFreeze").textContent = frozen ? "Unfreeze" : "Freeze";
      addLog(frozen ? "[FREEZE] display paused (model still thinking)" : "[FREEZE] display resumed", "dim");
    }

    function doHelp(){
      addLog("Commands: help | scan | mark | branch | reframe | freeze | jitter | clear", "dim");
      addLog("Example: replay -10m  (mocked)  /  export timeline (mocked)", "dim");
    }

    function runCommand(raw){
      const cmd = (raw || "").trim();
      if(!cmd) return;

      const c = cmd.toLowerCase();
      if(c === "help") return doHelp();
      if(c === "scan") return doScan();
      if(c === "mark") return doMark();
      if(c === "branch") return doBranch();
      if(c === "reframe") return doReframe();
      if(c === "freeze") return doFreeze();
      if(c === "jitter") return jitterSensors();
      if(c === "clear") return clearLog();
      if(c.startsWith("replay")){
        addLog("[REPLAY] requested → " + cmd, "cyan");
        addEvent("SCAN", "Replay requested (mock): " + cmd);
        return;
      }
      if(c.startsWith("export")){
        addLog("[EXPORT] timeline exported (mock)", "cyan");
        addEvent("ANCHOR", "Export completed (mock).");
        return;
      }

      addLog("[UNKNOWN] " + cmd, "bad");
    }

    function clearLog(){
      logEl.innerHTML = "";
      addLog("Log cleared.", "dim");
    }

    // Buttons
    $("#btnScan").addEventListener("click", doScan);
    $("#btnReframe").addEventListener("click", doReframe);
    $("#btnFreeze").addEventListener("click", doFreeze);
    $("#btnAppend").addEventListener("click", () => addLog("[NOTE] narrative layer appended with observation stub", "dim"));
    $("#btnClear").addEventListener("click", clearLog);

    $("#btnJitter").addEventListener("click", () => { jitterSensors(); addLog("[SENSORS] jitter injected", "dim"); });
    $("#btnMark").addEventListener("click", doMark);
    $("#btnExport").addEventListener("click", () => runCommand("export timeline"));

    $("#btnRun").addEventListener("click", () => {
      const v = $("#cmd").value;
      $("#cmd").value = "";
      runCommand(v);
    });

    $("#cmd").addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        const v = $("#cmd").value;
        $("#cmd").value = "";
        runCommand(v);
      }
    });

    // Init
    renderSensors();
    addLog("[BOOT] SOL interface initialized", "ok");
    addLog("Hint: type 'help' in the command line.", "dim");
    addEvent("ANCHOR", "Boot: interface online; world model warmed.");
    addEvent("SCAN", "Baseline sweep complete; anomaly budget allocated.");
    requestAnimationFrame(loop);

    // Gentle heartbeat
    setInterval(() => {
      if(!frozen) jitterSensors();
      const secs = Math.floor(rnd(10,40));
      $("#hz").textContent = "+00:" + String(Math.floor(secs/60)).padStart(2,"0") + ":" + String(secs%60).padStart(2,"0");
    }, 2500);
  </script>
</body>
</html>