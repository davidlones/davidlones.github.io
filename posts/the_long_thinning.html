<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Long Thinning [Reconstructed]</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind (runtime) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { background: #020617; }
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: #000; }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #064e3b;
      border-radius: 2px;
    }
  </style>
</head>

<body class="bg-neutral-950 text-emerald-500 font-mono">
  <div id="root"></div>

  <!-- App -->
  <script type="text/babel" data-presets="react">
    import React, { useState, useMemo, useEffect } from "https://esm.sh/react";
    import { createRoot } from "https://esm.sh/react-dom/client";

    import {
      AreaChart, Area, LineChart, Line,
      XAxis, YAxis, CartesianGrid,
      Tooltip, ResponsiveContainer, ReferenceLine
    } from "https://esm.sh/recharts";

    import {
      Activity, Users, Zap, Database, Info,
      ShieldAlert, ChevronLeft, ChevronRight
    } from "https://esm.sh/lucide-react";

    const ARCHIVE_DATA = [
      { year: 0, title: "BASELINE", exited: 3, buffer: 3.2, jobs: 62, active: 397, logs: "Employment fluctuates within expected tolerances. Buffers hold. System imagines full recovery." },
      { year: 1, title: "CONTINUITY", exited: 9, buffer: 2.6, jobs: 60.5, active: 391, logs: "Job capacity dips. Hiring friction increases. First workers cross 6-month unemployment threshold." },
      { year: 2, title: "DURATION", exited: 22, buffer: 2.1, jobs: 59, active: 378, logs: "Automation compounds. Output increases with fewer hands. Employment becomes probabilistic." },
      { year: 3, title: "NEGATIVE SPACE", exited: 40, buffer: 1.5, jobs: 57, active: 360, logs: "Bottom decile disappears from formal accounting. Absorption into shadow economies." },
      { year: 4, title: "STICKY FLOOR", exited: 60, buffer: 0.9, jobs: 55, active: 340, logs: "Re-entry probability measurably decays. Human adaptability becomes systemic liability." },
      { year: 5, title: "CROSSING", exited: 75, buffer: -0.2, jobs: 53.5, active: 325, logs: "Median buffer crosses zero. System adapts by load shedding." },
      { year: 6, title: "ADJUSTMENT", exited: 90, buffer: -0.4, jobs: 52, active: 310, logs: "Automation finalizes advantage. No vote is taken." },
      { year: 7, title: "SILENCE", exited: 120, buffer: -0.5, jobs: 51.5, active: 280, logs: "The curve smooths. Exits no longer spike." },
      { year: 8, title: "SCARCITY", exited: 140, buffer: -0.6, jobs: 51, active: 260, logs: "Scarcity treated as ambient condition." },
      { year: 9, title: "THE LONG TAIL", exited: 150, buffer: -0.7, jobs: 50.5, active: 250, logs: "Vulnerable already gone. Survivorship stabilizes." },
      { year: 10, title: "STEADY STATE", exited: 152, buffer: -0.8, jobs: 50, active: 248, logs: "System status: Stable. Human participation no longer required." },
    ];

    function App() {
      const [currentYear, setCurrentYear] = useState(0);
      const [isPlaying, setIsPlaying] = useState(false);

      useEffect(() => {
        if (!isPlaying) return;
        const id = setInterval(() => {
          setCurrentYear(y => (y < 10 ? y + 1 : 0));
        }, 2000);
        return () => clearInterval(id);
      }, [isPlaying]);

      const stats = ARCHIVE_DATA[currentYear];

      const dots = useMemo(() => {
        return Array.from({ length: 400 }).map((_, i) => {
          if (i < stats.exited) return "exited";
          if (i < stats.exited + (400 - stats.active)) return "precarious";
          return "active";
        });
      }, [stats]);

      return (
        <div className="min-h-screen p-4 md:p-8 flex flex-col gap-6">
          <header className="border-b border-emerald-900/50 pb-4 flex justify-between">
            <div>
              <h1 className="text-xl font-bold flex items-center gap-2">
                <Database className="w-5 h-5" />
                THE LONG THINNING [RECONSTRUCTED]
              </h1>
              <p className="text-xs text-emerald-700 uppercase">
                Archival Simulation // CIV-ECON-Δ120
              </p>
            </div>
            <div className="text-right">
              <div className="text-xs text-emerald-700">CURRENT EPOCH</div>
              <div className="text-lg">YEAR #0# + {currentYear}</div>
              <div className={`text-xs ${currentYear >= 5 ? "text-amber-500" : "text-emerald-500"}`}>
                {currentYear >= 5 ? "OPTIMIZED_STABLE" : "PARTICIPATORY"}
              </div>
            </div>
          </header>

          <main className="grid lg:grid-cols-12 gap-6 flex-grow">

            {/* Population */}
            <section className="lg:col-span-4 border border-emerald-900/30 p-4">
              <h2 className="text-xs font-bold uppercase flex gap-2 mb-2">
                <Users className="w-3 h-3" /> Population Density
              </h2>
              <div className="grid grid-cols-20 gap-1">
                {dots.map((d, i) => (
                  <div key={i} className={`aspect-square ${
                    d === "active" ? "bg-emerald-500" :
                    d === "precarious" ? "bg-emerald-900" :
                    "bg-neutral-800 opacity-20"
                  }`} />
                ))}
              </div>
            </section>

            {/* Metrics */}
            <section className="lg:col-span-5 border border-emerald-900/30 p-4">
              <h2 className="text-xs font-bold uppercase flex gap-2 mb-4">
                <Activity className="w-3 h-3" /> System Metrics
              </h2>
              <div className="h-64">
                <ResponsiveContainer width="100%" height="100%">
                  <AreaChart data={ARCHIVE_DATA}>
                    <CartesianGrid stroke="#064e3b" strokeDasharray="3 3" />
                    <XAxis dataKey="year" stroke="#065f46" />
                    <YAxis stroke="#065f46" />
                    <ReferenceLine y={0} stroke="#ef4444" strokeDasharray="3 3" />
                    <Area dataKey="buffer" stroke="#10b981" fill="#10b98144" />
                    <Line dataKey="jobs" stroke="#34d399" dot={false} />
                    <ReferenceLine x={currentYear} stroke="#fbbf24" />
                  </AreaChart>
                </ResponsiveContainer>
              </div>
            </section>

            {/* Logs */}
            <section className="lg:col-span-3 border border-emerald-900/30 p-4 overflow-y-auto custom-scrollbar">
              <h2 className="text-xs font-bold uppercase flex gap-2 mb-4">
                <Info className="w-3 h-3" /> Event Log
              </h2>
              {ARCHIVE_DATA.map((e, i) => (
                <div
                  key={i}
                  className={`mb-2 p-2 cursor-pointer ${
                    i === currentYear ? "border-l-2 border-emerald-500" : "opacity-40"
                  }`}
                  onClick={() => setCurrentYear(i)}
                >
                  <div className="text-xs font-bold">
                    YEAR #0# + {e.year} — {e.title}
                  </div>
                </div>
              ))}
            </section>

          </main>

          <footer className="flex items-center gap-4 border border-emerald-900/30 p-3">
            <button onClick={() => setIsPlaying(p => !p)} className="border px-3 py-1">
              {isPlaying ? "PAUSE" : <Zap />}
            </button>
            <button onClick={() => setCurrentYear(Math.max(0, currentYear - 1))}><ChevronLeft /></button>
            <input type="range" min="0" max="10" value={currentYear}
              onChange={e => setCurrentYear(+e.target.value)}
              className="flex-grow accent-emerald-500" />
            <button onClick={() => setCurrentYear(Math.min(10, currentYear + 1))}><ChevronRight /></button>
          </footer>
        </div>
      );
    }

    createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
